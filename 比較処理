function updateSheets() {
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var sheetA = ss.getSheetByName("Aシート");
  var sheetB = ss.getSheetByName("Bシート");
  
  var dataA = sheetA.getDataRange().getValues();
  var dataB = sheetB.getDataRange().getValues();
  
  var headerA = dataA[0];
  var idColumnA = headerA.indexOf("ID");
  var remarkColumnA = headerA.indexOf("備考");
  
  var headerB = dataB[0];
  var idColumnB = headerB.indexOf("ID");
  var remarkColumnB = headerB.indexOf("備考");
  
  var timestamp = Utilities.formatDate(new Date(), "Asia/Tokyo", "yyyy/MM");
  
  var updatedRows = 0;
  var newRows = [];
  
  // Bシートの各行を処理
  for (var i = 1; i < dataB.length; i++) {
    var idB = dataB[i][idColumnB];
    var found = false;
    
    // Aシートで対応するIDを検索
    for (var j = 1; j < dataA.length; j++) {
      if (dataA[j][idColumnA] === idB) {
        // IDが一致した場合の処理
        // 備考列: タイムスタンプとAシートの備考を追加
        dataB[i][remarkColumnB] += "\n" + timestamp + " " + dataA[j][remarkColumnA];
        
        // その他の列: Aシートの値で上書き
        for (var k = 0; k < headerB.length; k++) {
          if (k !== remarkColumnB) {
            dataB[i][k] = dataA[j][k];
          }
        }
        
        found = true;
        updatedRows++;
        break;
      }
    }
    
    if (!found) {
      // Bシートに存在するが、Aシートに存在しないIDは変更しない
      continue;
    }
  }
  
  // Aシートの新規IDを処理
  for (var j = 1; j < dataA.length; j++) {
    var idA = dataA[j][idColumnA];
    var found = false;
    
    for (var i = 1; i < dataB.length; i++) {
      if (dataB[i][idColumnB] === idA) {
        found = true;
        break;
      }
    }
    
    if (!found) {
      // 新規IDの場合、新しい行を追加
      var newRow = dataA[j].slice();
      newRow[remarkColumnB] = timestamp + " " + dataA[j][remarkColumnA];
      newRows.push(newRow);
    }
  }
  
  // 新規行を最終行に追加
  if (newRows.length > 0) {
    dataB = dataB.concat(newRows);
  }
  
  // Bシートを更新
  sheetB.getRange(1, 1, dataB.length, dataB[0].length).setValues(dataB);
  
  // ログ出力
  Logger.log("更新された行数: " + updatedRows);
  Logger.log("追加された行数: " + newRows.length);
}
